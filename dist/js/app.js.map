{"version":3,"file":"app.js","sources":["../../app/js/main.js"],"sourcesContent":["// @ts-nocheck\n/* global firebase */\n\nconst App = {\n  init() {\n    const that = this\n    const firebaseConfig = {\n      apiKey: 'AIzaSyCmEjhSDdqEsmIdxe9VN4GI7IxTD2LhU4I',\n      authDomain: 'testproject-48d5e.firebaseapp.com',\n      databaseURL: 'https://testproject-48d5e.firebaseio.com',\n      projectId: 'testproject-48d5e',\n      storageBucket: 'testproject-48d5e.appspot.com',\n      messagingSenderId: '121120459695',\n      appId: '1:121120459695:web:e8ecc54371f88ce6'\n    }\n\n    firebase.initializeApp(firebaseConfig)\n    this.database = firebase.firestore()\n    this.storageService = firebase.storage()\n    this.storageRef = this.storageService.ref()\n\n    const provider = new firebase.auth.FacebookAuthProvider()\n\n    provider.setCustomParameters({\n      display: 'popup'\n    })\n\n    firebase.auth().onAuthStateChanged(function(user) {\n      if (user) {\n        const html = `\n          <div class=\"header\">\n            <button class=\"logout-btn firebase-btn\">Выйти</button>\n          </div>\n          <div class=\"page\">\n            <div class=\"page__title\">Добро пожаловать, ${user.displayName}!</div>\n            <div class=\"page__subtitle\">Выберите файл для загрузки:</div>\n            <div id=\"filesubmit\">\n              <input type=\"file\" class=\"file-select\" accept=\"image/*\"/>\n              <div class=\"placeholder\"></div>\n              <div class=\"msg\"></div>\n              <button class=\"send firebase-btn\">Отправить</button>\n            </div>\n            \n            <div class=\"list\"></div>\n          </div>\n        `\n\n        $('#app').html(html)\n        that.getList()\n      } else {\n        $('#app').html(\n          '<div class=\"page\"><button class=\"auth-btn firebase-btn\">Войти</button><div class=\"list\"></div></div>'\n        )\n        that.getList()\n      }\n    })\n\n    $('#app').on('click', '.auth-btn', function() {\n      firebase.auth().signInWithPopup(provider)\n    })\n\n    $('#app').on('click', '.logout-btn', function() {\n      firebase.auth().signOut()\n    })\n\n    // $('#app').on('click', '.send', function() {\n    //   const val = $('.page__input').val()\n\n    //   if (val.length) {\n    //     $('.page__input').val('')\n    //     that.database\n    //       .collection('sandbox')\n    //       .add({\n    //         user: firebase.auth().currentUser.uid,\n    //         text: val,\n    //         created: firebase.firestore.FieldValue.serverTimestamp()\n    //       })\n    //       .then(function(docRef) {\n    //         // eslint-disable-next-line\n    //         console.log('Document written with ID: ', docRef.id)\n    //         that.getList()\n    //       })\n    //       .catch(function(error) {\n    //         // eslint-disable-next-line\n    //         console.error('Error adding document: ', error)\n    //       })\n    //   }\n    // })\n\n    $('#app').on('click', '.item__remove', function() {\n      that.database\n        .collection('sandbox')\n        .doc($(this).data('id'))\n        .delete()\n        .then(() => {\n          $(this)\n            .parent()\n            .remove()\n        })\n        .catch(error => {\n          // eslint-disable-next-line\n          console.error('Error removing document: ', error)\n        })\n    })\n\n    let selectedFile\n\n    $('#app').on('click', '.placeholder', function() {\n      $('.file-select').click()\n    })\n\n    $('#app').on('change', '.file-select', function(e) {\n      selectedFile = e.target.files[0]\n      $('.placeholder').html(\n        `<img src=\"${URL.createObjectURL(e.target.files[0])}\" class=\"placeholder__img\">`\n      )\n    })\n\n    $('#app').on('click', '.send', function() {\n      const uploadTask = that.storageRef.child(`images/${selectedFile.name}`).put(selectedFile) // create a child directory called images, and place the file inside this directory\n\n      uploadTask.on(\n        'state_changed',\n        snapshot => {\n          // eslint-disable-next-line\n          console.log(snapshot)\n        },\n        error => {\n          // eslint-disable-next-line\n          console.log(error)\n        },\n        () => {\n          $('.placeholder').empty()\n          $('.msg').html('Изображение загружено')\n          that.getList()\n        }\n      )\n    })\n  },\n\n  getList() {\n    const that = this\n    var listRef = this.storageRef.child('images')\n\n    $('.list').empty()\n    listRef\n      .listAll()\n      .then(res => {\n        res.items.map(item => {\n          that.storageService\n            .ref(item.fullPath)\n            .getDownloadURL()\n            .then(url => {\n              $('.list').append(`\n                <img class=\"list__item\" src=\"${url}\">`)\n            })\n        })\n      })\n      .catch(function(error) {\n        // eslint-disable-next-line\n        console.error(error)\n      })\n  }\n}\n\n$('document').ready(function() {\n  App.init()\n})\n"],"names":["App","that","firebaseConfig","initializeApp","database","firebase","firestore","storageService","storage","storageRef","ref","provider","auth","FacebookAuthProvider","setCustomParameters","onAuthStateChanged","user","html","displayName","getList","on","signInWithPopup","signOut","collection","doc","$","data","delete","then","parent","remove","catch","error","selectedFile","click","e","target","files","URL","createObjectURL","uploadTask","child","name","put","log","snapshot","empty","listRef","listAll","items","map","item","fullPath","getDownloadURL","append","url","ready","init"],"mappings":"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"}