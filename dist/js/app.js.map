{"version":3,"file":"app.js","sources":["../../app/js/modules/cookie.js","../../app/js/modules/settings.js","../../app/js/modules/auth.js","../../app/js/main.js"],"sourcesContent":["export default {\n  get(name) {\n    const matches = window.parent.document.cookie.match(\n      new RegExp(`(?:^|; )${name.replace(/([.$?*|{}()[]\\\\\\/\\+^])/g, '\\\\$1')}=([^;]*)`));\n\n    return matches ? decodeURIComponent(matches[1]) : undefined;\n  },\n\n  set(name, value, options = {}) {\n    let expires = options.expires;\n    const cookieOption = options;\n    let updatedCookie;\n    var d = new Date();\n\n    if (typeof expires === 'number' && expires) {\n      d.setTime(d.getTime() + (expires * 1000));\n      expires = d;\n    } else {\n      expires = new Date(d.getTime() + (14 * 24 * 60 * 60 * 1000));\n    }\n    if (expires && expires.toUTCString) {\n      expires = expires.toUTCString();\n      cookieOption.expires = expires;\n    }\n    var cookieValue = encodeURIComponent(value);\n    \n    updatedCookie = `${name}=${cookieValue}`;\n    Object.keys(cookieOption).forEach((propName) => {\n      updatedCookie += `; ${propName}`;\n      var propValue = cookieOption[propName];\n\n      if (propValue !== true) {\n        updatedCookie += `=${propValue}`;\n      }\n    });\n    window.parent.document.cookie = updatedCookie;\n  },\n\n  delete(name) {\n    this.set(name, '', { expires: -1 });\n  },\n};\n","var isMobile = (function() {\n  if (\n    navigator.userAgent.match(/Android/i) ||\n    navigator.userAgent.match(/webOS/i) ||\n    navigator.userAgent.match(/iPhone/i) ||\n    navigator.userAgent.match(/iPad/i) ||\n    navigator.userAgent.match(/iPod/i) ||\n    navigator.userAgent.match(/BlackBerry/i) ||\n    navigator.userAgent.match(/Windows Phone/i)\n  ) {\n    return true\n  }\n\n  return false\n})()\n\nconst appOptions = {\n  authUrl: 'https://login.dnevnik.ru/oauth2',\n  grantUrl: 'https://api.dnevnik.ru/v1/authorizations',\n  scope: 'CommonInfo',\n  clientId: 'c2eb1c41dac14f98883add55494b9cf9',\n  redirectUrl: window.location.href + '?auth=true',\n  provider: 'firebase',\n  api: 'https://api.dnevnik.ru/v1/',\n  apiMobile: 'https://api.dnevnik.ru/modile/v1/',\n  isMobile: isMobile,\n  userLink: 'https://dnevnik.ru/user/user.aspx?user=',\n  cdnPath: 'https://ad.csdnevnik.ru/special/staging/petsforever/img/',\n  cdnMain: 'https://ad.csdnevnik.ru/special/staging/petsforever/',\n  origin: '.dnevnik.ru',\n  admins: [\n    '1000006315838',\n    '1000006435101',\n    '1000004681017',\n    '1000004934922',\n    '1000005435557',\n    '1000008630961',\n    '1000003565717'\n  ]\n}\n\nexport default appOptions\n","import Cookie from './cookie'\nimport appOptions from './settings'\n\nexport var Auth = {\n  token: undefined,\n  auth(callback) {\n    var token\n\n    function getToken() {\n      token = /access_token=([-0-9a-zA-Z_]+)/.exec(window.location.hash) || []\n\n      return token[1]\n    }\n    token = Cookie.get(`${appOptions.provider}_token`) || getToken()\n    if (undefined !== token) {\n      Cookie.delete(`${appOptions.provider}_token`)\n      Cookie.set(`${appOptions.provider}_token`, token)\n      this.token = token\n      if (typeof callback === 'function') {\n        callback()\n      }\n    } else {\n      const error = /error=([-0-9a-zA-Z_]+)/.exec(window.location.hash) || []\n\n      if (undefined !== error[1]) {\n        Cookie.delete(`${appOptions.provider}_token`)\n        this.token = undefined\n      } else {\n        window.location.href = `${appOptions.authUrl}?response_type=token&client_id=${\n          appOptions.clientId\n        }&scope=${appOptions.scope}&redirect_uri=${appOptions.redirectUrl}`\n      }\n    }\n  }\n}\n","// @ts-nocheck\n/* global firebase */\nimport { Auth } from './modules/auth.js'\n\nconst App = {\n  init() {\n    const that = this\n\n    if (document.location.href.indexOf('access_token') > -1) {\n      Auth.auth(function() {\n        var path = window.location.pathname.substring(0, window.location.pathname.length)\n\n        history.pushState('', document.title, path)\n      })\n    }\n\n    const firebaseConfig = {\n      apiKey: 'AIzaSyCmEjhSDdqEsmIdxe9VN4GI7IxTD2LhU4I',\n      authDomain: 'testproject-48d5e.firebaseapp.com',\n      databaseURL: 'https://testproject-48d5e.firebaseio.com',\n      projectId: 'testproject-48d5e',\n      storageBucket: 'testproject-48d5e.appspot.com',\n      messagingSenderId: '121120459695',\n      appId: '1:121120459695:web:e8ecc54371f88ce6'\n    }\n\n    firebase.initializeApp(firebaseConfig)\n    this.database = firebase.firestore()\n    this.storageService = firebase.storage()\n    this.storageRef = this.storageService.ref()\n\n    const provider = new firebase.auth.FacebookAuthProvider()\n\n    provider.setCustomParameters({\n      display: 'popup'\n    })\n\n    firebase.auth().onAuthStateChanged(function(user) {\n      if (user) {\n        const html = `\n          <div class=\"header\">\n            <button class=\"logout-btn firebase-btn\">Выйти</button>\n          </div>\n          <div class=\"page\">\n            <div class=\"page__title\">Добро пожаловать, ${user.displayName}!</div>\n            <div class=\"page__subtitle\">Выберите файл для загрузки:</div>\n            <div id=\"filesubmit\">\n              <input type=\"file\" class=\"file-select\" accept=\"image/*\"/>\n              <div class=\"placeholder\"></div>\n              <div class=\"msg\"></div>\n              <button class=\"send firebase-btn\">Отправить</button>\n            </div>\n            \n            <div class=\"list\"></div>\n          </div>\n        `\n\n        $('#app').html(html)\n        that.getList()\n      } else {\n        $('#app').html(\n          `<div class=\"page\">\n            <button class=\"auth-btn auth-btn-fb firebase-btn\">Войти через Facebook</button><br>\n            <button class=\"auth-btn auth-btn-dn firebase-btn\">Войти через Дневник.ру</button>\n            <div class=\"list\"></div>\n          </div>`\n        )\n        that.getList()\n      }\n    })\n\n    $('#app').on('click', '.auth-btn-fb', function() {\n      firebase.auth().signInWithPopup(provider)\n    })\n\n    $('#app').on('click', '.auth-btn-dn', function() {\n      Auth.auth()\n    })\n\n    $('#app').on('click', '.logout-btn', function() {\n      firebase.auth().signOut()\n    })\n\n    // $('#app').on('click', '.send', function() {\n    //   const val = $('.page__input').val()\n\n    //   if (val.length) {\n    //     $('.page__input').val('')\n    //     that.database\n    //       .collection('sandbox')\n    //       .add({\n    //         user: firebase.auth().currentUser.uid,\n    //         text: val,\n    //         created: firebase.firestore.FieldValue.serverTimestamp()\n    //       })\n    //       .then(function(docRef) {\n    //         // eslint-disable-next-line\n    //         console.log('Document written with ID: ', docRef.id)\n    //         that.getList()\n    //       })\n    //       .catch(function(error) {\n    //         // eslint-disable-next-line\n    //         console.error('Error adding document: ', error)\n    //       })\n    //   }\n    // })\n\n    $('#app').on('click', '.item__remove', function() {\n      that.database\n        .collection('sandbox')\n        .doc($(this).data('id'))\n        .delete()\n        .then(() => {\n          $(this)\n            .parent()\n            .remove()\n        })\n        .catch(error => {\n          // eslint-disable-next-line\n          console.error('Error removing document: ', error)\n        })\n    })\n\n    let selectedFile\n\n    $('#app').on('click', '.placeholder', function() {\n      $('.file-select').click()\n    })\n\n    $('#app').on('change', '.file-select', function(e) {\n      selectedFile = e.target.files[0]\n      $('.placeholder').html(\n        `<img src=\"${URL.createObjectURL(e.target.files[0])}\" class=\"placeholder__img\">`\n      )\n    })\n\n    $('#app').on('click', '.send', function() {\n      const uploadTask = that.storageRef.child(`images/${selectedFile.name}`).put(selectedFile) // create a child directory called images, and place the file inside this directory\n\n      uploadTask.on(\n        'state_changed',\n        snapshot => {\n          // eslint-disable-next-line\n          console.log(snapshot)\n        },\n        error => {\n          // eslint-disable-next-line\n          console.log(error)\n        },\n        () => {\n          $('.placeholder').empty()\n          $('.msg').html('Изображение загружено')\n          that.getList()\n        }\n      )\n    })\n  },\n\n  getList() {\n    const that = this\n    var listRef = this.storageRef.child('images')\n\n    $('.list').empty()\n    listRef\n      .listAll()\n      .then(res => {\n        res.items.map(item => {\n          that.storageService\n            .ref(item.fullPath)\n            .getDownloadURL()\n            .then(url => {\n              $('.list').append(`\n                <img class=\"list__item\" src=\"${url}\">`)\n            })\n        })\n      })\n      .catch(function(error) {\n        // eslint-disable-next-line\n        console.error(error)\n      })\n  }\n}\n\n$('document').ready(function() {\n  App.init()\n})\n"],"names":["name","matches","window","parent","document","cookie","match","RegExp","replace","decodeURIComponent","undefined","value","options","expires","cookieOption","updatedCookie","d","Date","setTime","getTime","toUTCString","cookieValue","encodeURIComponent","keys","forEach","propName","propValue","set","isMobile","navigator","userAgent","appOptions","location","href","Auth","callback","token","getToken","exec","hash","Cookie","get","provider","delete","error","authUrl","clientId","scope","redirectUrl","App","that","indexOf","auth","path","pathname","substring","length","pushState","title","firebaseConfig","initializeApp","database","firebase","firestore","storageService","storage","storageRef","ref","FacebookAuthProvider","setCustomParameters","onAuthStateChanged","user","html","displayName","getList","on","signInWithPopup","signOut","collection","doc","$","data","then","remove","catch","selectedFile","click","e","target","files","URL","createObjectURL","uploadTask","child","put","log","snapshot","empty","listRef","listAll","items","map","item","fullPath","getDownloadURL","append","url","ready","init"],"mappings":"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"}